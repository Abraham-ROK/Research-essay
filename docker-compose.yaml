version: "3.3"

# networks:

#    traefik:
#       external:
#          name: custom_network
#       ipam: # ipam = ap address management 
#          driver: default 
#          config:
#             - subnet: 192.168.92.0/24
   

services:

  backend:
     image: 0abraham0/backend_image:latest
     container_name: backend
     build: ./web-app/backend
     ports:
       - 5001:5001
    #  networks:
    #    - traefik
     volumes:
       - ./web-app/backend/controllers:/app/controllers:ro # this line sink every file i have in my backend in the folder app for my image and help make a live update of my files
       - ./web-app/backend/server.py:/app/server.py:ro   # this is called bind volumes 
                                                        # ":ro" means that my image will read only the files from backend

     depends_on:
       - traefik
     labels:
       - "traefik.http.routers.backend.rule=Host(`backend.localhost`)"

    #    - "traefik.docker.network=traefik"
    #    - "traefik.backend=xavki"
    #    - "traefik.frontend.rule=Host:xavki.localhost" 
    #    - "traefik.port=5001"


  frontend:
     image: 0abraham0/frontend_image:latest
     container_name: frontend
     build: ./web-app/frontend
     ports:
       - 3001:3000
    #  networks:
    #    - traefik
     volumes:
       - ./web-app/frontend/src:/app/src:ro
     depends_on:
       - backend
       - traefik
     labels:
       - "traefik.http.routers.frontend.rule=Host(`frontend.localhost`)"
  
  traefik:
    image: traefik:v3.0
    container_name: loabalancer
    command: 
      - --api.insecure=true 
      - --providers.docker
    ports:
      - "80:80"
      - "8080:8080" 
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock 
      # - /dev/null:/traefik.toml
    # networks:
    #   - webgateway
     